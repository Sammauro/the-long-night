<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE LONG NIGHT â€” UI v4</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --cyan:   #00e5ff;
    --violet: #b44fff;
    --acid:   #39ff14;
    --red:    #ff2d2d;
    --gold:   #ffaa00;
    --text:   #c8d8e8;
    --muted:  #4a5570;
    --dim:    #1e2238;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background:#04040e; width:100vw; height:100vh;
    overflow:hidden; font-family:'Rajdhani',sans-serif;
    color:var(--text); user-select:none;
  }
  body::after {
    content:''; position:fixed; inset:0;
    background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.05) 3px,rgba(0,0,0,0.05) 4px);
    pointer-events:none; z-index:300;
  }

  /* â”€â”€ CANVAS â”€â”€ */
  #gc { position:fixed; inset:0; z-index:0; cursor:grab; }
  #gc:active { cursor:grabbing; }

  /* â”€â”€ AMBIENT â”€â”€ */
  .amb {
    position:fixed; inset:0; z-index:1; pointer-events:none;
    background:
      radial-gradient(ellipse 30% 20% at 40% 47%, rgba(180,79,255,0.09) 0%, transparent 70%),
      radial-gradient(ellipse 20% 15% at 60% 44%, rgba(255,45,45,0.07) 0%, transparent 70%),
      radial-gradient(ellipse 70% 28% at 50% 100%, rgba(0,0,0,0.75) 0%, transparent 70%),
      radial-gradient(ellipse 60% 20% at 50% 0%,   rgba(0,0,0,0.55) 0%, transparent 70%);
  }

  /* â”€â”€ UI ROOT â”€â”€ */
  #ui { position:fixed; inset:0; z-index:10; pointer-events:none; }
  #ui > * { pointer-events:all; }

  .mono { font-family:'Share Tech Mono',monospace; }
  .orb  { font-family:'Orbitron',monospace; }

  /* â•â• TURNO top center â•â• */
  #hud-turn {
    position:absolute; top:14px; left:50%; transform:translateX(-50%);
    display:flex; align-items:center; gap:10px;
    pointer-events:none;
  }
  .t-lbl { font-family:'Share Tech Mono',monospace; font-size:8px; color:var(--muted); letter-spacing:3px; }
  .t-num { font-family:'Orbitron',monospace; font-size:18px; font-weight:900; color:var(--cyan); text-shadow:0 0 14px var(--cyan); }
  .t-phase { font-family:'Share Tech Mono',monospace; font-size:8px; color:var(--muted); letter-spacing:2px; }

  /* â•â• GIOCATORE top left â•â• */
  #hud-player {
    position:absolute; top:14px; left:14px;
    display:flex; flex-direction:column; gap:6px;
    filter:drop-shadow(0 2px 12px rgba(0,0,0,0.9));
  }
  .p-name {
    font-family:'Orbitron',monospace; font-size:9px; font-weight:700;
    color:var(--violet); letter-spacing:3px; text-shadow:0 0 12px var(--violet);
    display:flex; align-items:center; gap:5px;
  }
  .p-name::before {
    content:''; width:5px; height:5px; border-radius:50%;
    background:var(--violet); box-shadow:0 0 8px var(--violet);
    animation:pp 2s ease-in-out infinite; flex-shrink:0;
  }
  @keyframes pp { 0%,100%{opacity:1} 50%{opacity:.4} }
  .s-row { display:flex; align-items:center; gap:6px; }
  .s-ic { font-size:10px; width:12px; text-align:center; flex-shrink:0; }
  .bw { width:88px; height:3px; background:rgba(255,255,255,0.06); border-radius:2px; overflow:hidden; }
  .bf { height:100%; border-radius:2px; }
  .bf-hp { width:80%; background:linear-gradient(90deg,var(--acid),#00ff88); box-shadow:0 0 5px var(--acid); }
  .bf-pt { width:67%; background:linear-gradient(90deg,var(--violet),#dd88ff); box-shadow:0 0 5px var(--violet); }
  .sv { font-family:'Share Tech Mono',monospace; font-size:9px; color:var(--muted); min-width:28px; }
  .pm-pips { display:flex; gap:3px; }
  .pip { width:7px; height:7px; border-radius:50%; background:var(--cyan); box-shadow:0 0 5px var(--cyan); }
  .pip.e { background:transparent; border:1px solid rgba(255,255,255,0.1); box-shadow:none; }
  .tags { display:flex; gap:3px; flex-wrap:wrap; margin-top:1px; }
  .tag {
    font-family:'Share Tech Mono',monospace; font-size:7px;
    padding:1px 5px; border-radius:2px; border:1px solid; background:rgba(0,0,0,0.4);
  }
  .tag.sc { border-color:rgba(255,170,0,0.5); color:var(--gold); }
  .tag.pm { border-color:rgba(0,229,255,0.4); color:var(--cyan); }
  .tag.fd { opacity:.35; }

  /* â•â• NEMICI top right â•â• */
  #hud-enemies {
    position:absolute; top:14px; right:14px;
    display:flex; flex-direction:column; gap:5px; align-items:flex-end;
    filter:drop-shadow(0 2px 12px rgba(0,0,0,0.9));
  }
  .e-title { font-family:'Share Tech Mono',monospace; font-size:8px; color:var(--red); letter-spacing:2px; opacity:.8; }
  .e-row { display:flex; align-items:center; gap:6px; flex-direction:row-reverse; }
  .e-icon { font-size:13px; }
  .e-info { display:flex; flex-direction:column; gap:2px; align-items:flex-end; }
  .e-name { font-family:'Share Tech Mono',monospace; font-size:8px; color:var(--muted); }
  .e-row.act .e-name { color:var(--red); }
  .e-bar { width:70px; height:3px; background:rgba(255,255,255,0.06); border-radius:1px; overflow:hidden; }
  .e-fill { height:100%; background:var(--red); border-radius:1px; }
  .e-row.act .e-fill { box-shadow:0 0 5px var(--red); }
  .e-tags { display:flex; gap:2px; }

  /* â•â• DADI â€” ultra-thin strip bottom left â•â• */
  #hud-dice {
    position:absolute; left:14px;
    bottom:148px;
    display:flex; align-items:center; gap:10px;
    filter:drop-shadow(0 2px 10px rgba(0,0,0,0.9));
    pointer-events:none;
  }
  .d-grp { display:flex; align-items:center; gap:4px; }
  .d-lbl { font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--muted); letter-spacing:1px; }
  .d-sep { width:1px; height:12px; background:rgba(255,255,255,0.06); }
  .dc {
    font-family:'Share Tech Mono',monospace; font-size:8px; font-weight:700;
    padding:1px 4px; border-radius:2px; border:1px solid; background:rgba(0,0,0,0.35);
  }
  .dc.v { border-color:rgba(57,255,20,0.35); color:var(--acid); }
  .dc.f { border-color:rgba(255,45,45,0.35); color:var(--red); }
  .dc.t { border-color:rgba(180,79,255,0.45); color:var(--violet); }
  .dc.b { border-color:rgba(255,255,255,0.08); color:var(--muted); }

  /* â•â• COOLDOWN bottom right â•â• */
  #hud-cd {
    position:absolute; right:14px; bottom:148px;
    display:flex; align-items:center; gap:6px;
    filter:drop-shadow(0 2px 10px rgba(0,0,0,0.9));
  }
  .cd-lbl { font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--muted); letter-spacing:1px; }
  .cd-row { display:flex; gap:4px; align-items:center; }
  .cd-body {
    width:26px; height:34px; border-radius:3px;
    background:rgba(8,8,24,0.5); border:1px solid rgba(255,255,255,0.07);
    display:flex; align-items:center; justify-content:center; font-size:13px;
    transition:transform .3s;
  }
  .cd-body.r90  { transform:rotate(90deg); }
  .cd-body.r180 { transform:rotate(180deg); }

  /* â•â• SEQUENZA bottom center â•â• */
  #hud-seq {
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:130px;
    display:flex; align-items:center; gap:5px;
    filter:drop-shadow(0 4px 16px rgba(0,0,0,0.95));
  }
  .seq-ttl {
    font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--muted);
    letter-spacing:2px; writing-mode:vertical-rl; transform:rotate(180deg);
    opacity:.4; margin-right:2px;
  }
  .sc { width:12px; height:1px; background:rgba(255,255,255,0.08); flex-shrink:0; }

  /* Dado nella sequenza */
  .sd {
    flex-shrink:0; width:48px; height:58px; border-radius:5px;
    border:1px solid; display:flex; flex-direction:column;
    align-items:center; justify-content:center; gap:2px;
    position:relative; cursor:pointer; transition:transform .15s;
    background:rgba(0,0,0,0.4);
  }
  .sd.used { opacity:.2; filter:grayscale(1); pointer-events:none; }
  .sd.v-d  { border-color:rgba(57,255,20,0.35); }
  .sd.f-d  { border-color:rgba(255,45,45,0.35); }
  .sd.t-d  { border-color:rgba(180,79,255,0.45); }
  .sd.ai-d { border-color:rgba(255,45,45,0.22); border-style:dashed; }
  .sd.active { transform:translateY(-7px); }
  .sd.v-d.active { border-color:var(--acid); box-shadow:0 0 18px rgba(57,255,20,.3),0 8px 20px rgba(0,0,0,.6); }
  .sd.t-d.active { border-color:var(--violet); box-shadow:0 0 22px rgba(180,79,255,.45),0 8px 20px rgba(0,0,0,.6); animation:tpulse 1.5s ease-in-out infinite; }
  @keyframes tpulse { 0%,100%{box-shadow:0 0 22px rgba(180,79,255,.45),0 8px 20px rgba(0,0,0,.6)} 50%{box-shadow:0 0 34px rgba(180,79,255,.65),0 8px 20px rgba(0,0,0,.6)} }
  .sd-type { font-family:'Share Tech Mono',monospace; font-size:6px; letter-spacing:.5px; opacity:.7; }
  .sd.v-d .sd-type { color:var(--acid); }
  .sd.f-d .sd-type { color:var(--red); }
  .sd.t-d .sd-type { color:var(--violet); }
  .sd.ai-d .sd-type { color:rgba(255,45,45,.6); }
  .sd-val { font-family:'Orbitron',monospace; font-weight:900; font-size:20px; line-height:1; }
  .sd.v-d .sd-val { color:var(--acid); }
  .sd.f-d .sd-val { color:var(--red); }
  .sd.t-d .sd-val { color:var(--violet); text-shadow:0 0 8px var(--violet); }
  .sd.ai-d .sd-val { color:rgba(255,45,45,.6); font-size:10px; line-height:1.3; text-align:center; }
  .sd-imp { font-size:8px; opacity:.55; }
  .sd.active::after {
    content:'â–¼'; position:absolute; bottom:-13px;
    font-size:8px; color:var(--cyan); text-shadow:0 0 6px var(--cyan);
    animation:bl 1s step-end infinite;
  }
  @keyframes bl { 0%,100%{opacity:1} 50%{opacity:0} }

  /* â•â• POPOVER sequenza â•â• */
  .seq-pop {
    position:absolute; bottom:calc(100% + 10px); left:50%; transform:translateX(-50%);
    background:rgba(6,6,22,0.95); border:1px solid rgba(255,255,255,0.1);
    border-radius:6px; padding:10px 12px; min-width:160px; max-width:200px;
    backdrop-filter:blur(16px); pointer-events:none;
    opacity:0; transition:opacity .15s; z-index:50;
    filter:drop-shadow(0 4px 20px rgba(0,0,0,0.8));
  }
  .sd:hover .seq-pop { opacity:1; }
  .pop-title {
    font-family:'Orbitron',monospace; font-size:9px; font-weight:700;
    margin-bottom:8px; padding-bottom:6px;
    border-bottom:1px solid rgba(255,255,255,0.07);
  }
  .sd.v-d .pop-title { color:var(--acid); }
  .sd.f-d .pop-title { color:var(--red); }
  .sd.t-d .pop-title { color:var(--violet); }
  .sd.ai-d .pop-title { color:var(--red); }
  .pop-row {
    display:flex; justify-content:space-between; align-items:flex-start;
    gap:8px; margin-bottom:5px;
  }
  .pop-key { font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--muted); letter-spacing:.5px; flex-shrink:0; }
  .pop-val { font-family:'Share Tech Mono',monospace; font-size:8px; color:var(--text); text-align:right; line-height:1.4; }
  .pop-val.hi-acid { color:var(--acid); }
  .pop-val.hi-red  { color:var(--red); }
  .pop-val.hi-viol { color:var(--violet); }
  .pop-val.hi-gold { color:var(--gold); }
  /* arrow */
  .seq-pop::after {
    content:''; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:5px solid transparent; border-top-color:rgba(255,255,255,0.1);
  }

  /* â•â• MESSAGE STRIP â•â• */
  #msg-strip {
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:120px;
    font-family:'Share Tech Mono',monospace; font-size:8px;
    color:var(--muted); letter-spacing:1.5px; text-align:center;
    opacity:0; transition:opacity .4s;
    pointer-events:none; white-space:nowrap;
    text-shadow:0 0 10px rgba(0,229,255,0.3);
  }
  #msg-strip.show { opacity:1; }

  /* â•â• CARTE bottom â•â• */
  #hud-cards {
    position:absolute; bottom:0; left:0; right:0; height:112px;
    display:flex; align-items:flex-end; justify-content:center;
    gap:8px; padding:0 16px 10px;
    background:linear-gradient(to top, rgba(4,4,14,0.92) 0%, transparent 100%);
    pointer-events:none;
  }
  #hud-cards > * { pointer-events:all; }

  .card {
    width:72px; height:98px; border-radius:6px;
    border:1px solid rgba(255,255,255,0.07);
    background:rgba(6,6,20,0.72); backdrop-filter:blur(14px);
    display:flex; flex-direction:column;
    position:relative; cursor:pointer; overflow:visible;
    transition:transform .2s ease, box-shadow .2s ease, width .25s ease, height .25s ease;
    flex-shrink:0; z-index:1;
  }

  /* Card hover â€” si allarga e mostra testo completo */
  .card:hover {
    transform:translateY(-28px);
    width:140px; height:180px;
    z-index:30;
    box-shadow:0 0 30px rgba(0,0,0,0.8), 0 12px 40px rgba(0,0,0,0.7);
  }
  .card.vg:hover { border-color:var(--acid); box-shadow:0 0 20px rgba(57,255,20,0.15),0 12px 40px rgba(0,0,0,.7); }
  .card.fu:hover { border-color:var(--red); box-shadow:0 0 20px rgba(255,45,45,0.15),0 12px 40px rgba(0,0,0,.7); }
  .card.sp:hover { border-color:var(--violet); box-shadow:0 0 20px rgba(180,79,255,0.2),0 12px 40px rgba(0,0,0,.7); }

  .card.on-cd { opacity:.3; cursor:not-allowed; transform:none !important; width:72px !important; height:98px !important; }
  .card.vg { border-color:rgba(57,255,20,0.18); }
  .card.fu { border-color:rgba(255,45,45,0.18); }
  .card.sp { border-color:rgba(180,79,255,0.18); }

  .c-stripe { height:2px; flex-shrink:0; border-radius:6px 6px 0 0; }
  .vg .c-stripe { background:var(--acid); }
  .fu .c-stripe { background:var(--red); }
  .sp .c-stripe { background:var(--violet); }

  .c-body { flex:1; display:flex; flex-direction:column; padding:5px 6px 3px; gap:2px; position:relative; overflow:hidden; }
  .c-cd { position:absolute; top:3px; right:3px; font-family:'Share Tech Mono',monospace; font-size:6px; color:var(--muted); }
  .c-name { font-family:'Rajdhani',sans-serif; font-weight:700; font-size:8px; text-transform:uppercase; line-height:1.2; padding-right:14px; }
  .card:hover .c-name { font-size:10px; }
  .c-cost { font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--muted); }
  .card:hover .c-cost { font-size:8px; margin-bottom:2px; }
  .c-art { flex:1; display:flex; align-items:center; justify-content:center; font-size:24px; }
  .card:hover .c-art { font-size:32px; }

  /* Testo effetto â€” visibile solo su hover */
  .c-effect {
    display:none; font-family:'Share Tech Mono',monospace; font-size:8px;
    color:var(--text); line-height:1.5; margin-top:4px;
    border-top:1px solid rgba(255,255,255,0.06); padding-top:5px;
  }
  .card:hover .c-effect { display:block; }

  .c-eco {
    height:14px; background:rgba(0,0,0,.3); border-top:1px solid rgba(255,255,255,.04);
    display:flex; align-items:center; padding:0 5px; gap:3px; flex-shrink:0;
  }
  .card:hover .c-eco { height:20px; }
  .eco-l { font-family:'Share Tech Mono',monospace; font-size:6px; color:var(--muted); letter-spacing:1px; }
  .card:hover .eco-l { font-size:8px; }
  .eco-v { font-family:'Share Tech Mono',monospace; font-size:7px; color:var(--gold); }
  .card:hover .eco-v { font-size:9px; }

  /* â”€â”€ fine turno â”€â”€ */
  #btn-end {
    position:absolute; bottom:14px; right:14px;
    font-family:'Orbitron',monospace; font-size:8px; font-weight:700;
    letter-spacing:2px; color:var(--cyan);
    border:1px solid rgba(0,229,255,0.35); border-radius:4px;
    padding:7px 13px; cursor:pointer; text-transform:uppercase;
    text-shadow:0 0 8px var(--cyan);
    background:rgba(0,0,0,0.5); backdrop-filter:blur(8px);
    transition:all .2s; pointer-events:all;
  }
  #btn-end:hover { background:rgba(0,229,255,.1); box-shadow:0 0 18px rgba(0,229,255,.2); }

  /* zoom hint */
  #zoom-hint {
    position:absolute; bottom:14px; left:14px;
    font-family:'Share Tech Mono',monospace; font-size:7px;
    color:var(--muted); letter-spacing:1px; opacity:.35; pointer-events:none;
  }
</style>
</head>
<body>

<canvas id="gc"></canvas>
<div class="amb"></div>

<div id="ui">

  <!-- TURNO -->
  <div id="hud-turn">
    <span class="t-lbl">TURNO</span>
    <span class="t-num">03</span>
    <span class="t-phase">Â· RISOLUZIONE</span>
  </div>

  <!-- GIOCATORE -->
  <div id="hud-player">
    <div class="p-name">INDAGATORE</div>
    <div class="s-row">
      <span class="s-ic">â™¥</span>
      <div class="bw"><div class="bf bf-hp"></div></div>
      <span class="sv">8/10</span>
    </div>
    <div class="s-row">
      <span class="s-ic">ğŸ’€</span>
      <div class="bw"><div class="bf bf-pt"></div></div>
      <span class="sv">4/6</span>
    </div>
    <div class="s-row">
      <span class="s-ic">âš¡</span>
      <div class="pm-pips">
        <div class="pip"></div><div class="pip"></div>
        <div class="pip e"></div><div class="pip e"></div>
      </div>
      <span class="sv">2 PM</span>
    </div>
    <div class="tags">
      <span class="tag sc">ğŸ›¡Ã—2</span>
      <span class="tag pm">+1PM</span>
      <span class="tag sc fd">ğŸ›¡Ã—1 T-1</span>
    </div>
  </div>

  <!-- NEMICI -->
  <div id="hud-enemies">
    <div class="e-title">NEMICI Ã—3</div>
    <div class="e-row act">
      <span class="e-icon">ğŸ§Ÿ</span>
      <div class="e-info">
        <div class="e-name">ZOMBIE A</div>
        <div class="e-bar"><div class="e-fill" style="width:100%"></div></div>
        <div class="e-tags"><span class="tag sc" style="font-size:6px;padding:1px 3px">ğŸ›¡Ã—2</span></div>
      </div>
    </div>
    <div class="e-row">
      <span class="e-icon">ğŸ§Ÿ</span>
      <div class="e-info">
        <div class="e-name">ZOMBIE B</div>
        <div class="e-bar"><div class="e-fill" style="width:50%"></div></div>
      </div>
    </div>
    <div class="e-row">
      <span class="e-icon">ğŸ§Ÿ</span>
      <div class="e-info">
        <div class="e-name">ZOMBIE C</div>
        <div class="e-bar"><div class="e-fill" style="width:100%"></div></div>
        <div class="e-tags"><span class="tag" style="border-color:rgba(255,45,45,.4);color:var(--red);font-size:6px;padding:1px 3px">VULNÃ—1</span></div>
      </div>
    </div>
  </div>

  <!-- DADI â€” striscia ultra-thin -->
  <div id="hud-dice">
    <div class="d-grp">
      <span class="d-lbl">PRE</span>
      <span class="dc v">d6âœŠ</span>
      <span class="dc t">d8ğŸ”®</span>
      <span class="dc f">d4ğŸ”¥</span>
    </div>
    <div class="d-sep"></div>
    <div class="d-grp">
      <span class="d-lbl">FUT</span>
      <span class="dc b">d4</span>
      <span class="dc b">+1PM</span>
    </div>
    <div class="d-sep"></div>
    <div class="d-grp">
      <span class="d-lbl">BAG</span>
      <span class="dc b">d4</span>
      <span class="dc b">d6</span>
    </div>
  </div>

  <!-- COOLDOWN -->
  <div id="hud-cd">
    <span class="cd-lbl">CD</span>
    <div class="cd-row">
      <div class="cd-body r90">ğŸ”¥</div>
      <div class="cd-body r180">âš”ï¸</div>
      <div class="cd-body"></div>
    </div>
  </div>

  <!-- SEQUENZA -->
  <div id="hud-seq">
    <span class="seq-ttl">SEQUENZA VINCOLATA</span>

    <!-- Dado usato -->
    <div class="sd v-d used">
      <div class="sd-type">VIGORE</div>
      <div class="sd-val">3</div>
      <div class="sd-imp">âœŠâœŠâœŠ</div>
    </div>
    <div class="sc"></div>

    <!-- Dado attivo con popover -->
    <div class="sd t-d active">
      <div class="sd-type">TERRORE</div>
      <div class="sd-val">4</div>
      <div class="sd-imp">ğŸ”®ğŸ”®ğŸ”®ğŸ”®</div>
      <div class="seq-pop">
        <div class="pop-title">DADO TERRORE</div>
        <div class="pop-row"><span class="pop-key">RISULTATO</span><span class="pop-val hi-viol">4 Presagi</span></div>
        <div class="pop-row"><span class="pop-key">USO</span><span class="pop-val">Spendi ğŸ”® per attivare carte Presagio o Affrontare le Paure</span></div>
        <div class="pop-row"><span class="pop-key">SCARTO</span><span class="pop-val hi-gold">Recupera 1 PT â†’ Terrore va in Futuro</span></div>
        <div class="pop-row"><span class="pop-key">NOTA</span><span class="pop-val">Dado unico â€” ritorna sempre</span></div>
      </div>
    </div>
    <div class="sc"></div>

    <!-- Dado AI con popover azione -->
    <div class="sd ai-d">
      <div class="sd-type">ZOM A</div>
      <div class="sd-val">ORDAÃ—2</div>
      <div class="seq-pop">
        <div class="pop-title">ZOMBIE A â€” AZIONE</div>
        <div class="pop-row"><span class="pop-key">AZIONE</span><span class="pop-val hi-red">ORDA â€” Attacco Multiplo</span></div>
        <div class="pop-row"><span class="pop-key">BERSAGLI</span><span class="pop-val">2 adiacenti</span></div>
        <div class="pop-row"><span class="pop-key">DANNO</span><span class="pop-val hi-red">1 DAN ciascuno</span></div>
        <div class="pop-row"><span class="pop-key">EFFETTO</span><span class="pop-val">Nessuno</span></div>
        <div class="pop-row"><span class="pop-key">POSIZIONE</span><span class="pop-val">Esagono C4 â†’ in portata</span></div>
      </div>
    </div>
    <div class="sc"></div>

    <!-- Dadi futuri -->
    <div class="sd v-d">
      <div class="sd-type">VIGORE</div>
      <div class="sd-val">?</div>
      <div class="sd-imp">â€”</div>
      <div class="seq-pop">
        <div class="pop-title">DADO VIGORE</div>
        <div class="pop-row"><span class="pop-key">STATO</span><span class="pop-val">Da lanciare</span></div>
        <div class="pop-row"><span class="pop-key">TIPO</span><span class="pop-val hi-acid">d6 â€” Forza âœŠ</span></div>
        <div class="pop-row"><span class="pop-key">USO</span><span class="pop-val">Attacchi fisici, movimento, carte Vigore</span></div>
      </div>
    </div>
    <div class="sc"></div>

    <div class="sd f-d">
      <div class="sd-type">FUOCO</div>
      <div class="sd-val">?</div>
      <div class="sd-imp">â€”</div>
      <div class="seq-pop">
        <div class="pop-title">DADO FUOCO</div>
        <div class="pop-row"><span class="pop-key">STATO</span><span class="pop-val">Da lanciare</span></div>
        <div class="pop-row"><span class="pop-key">TIPO</span><span class="pop-val hi-red">d4 â€” Elementale ğŸ”¥</span></div>
        <div class="pop-row"><span class="pop-key">USO</span><span class="pop-val">Carte Fuoco, Amplificazione Elementale +1DAN</span></div>
      </div>
    </div>
    <div class="sc"></div>

    <div class="sd ai-d">
      <div class="sd-type">ZOM C</div>
      <div class="sd-val">TERRÃ—4</div>
      <div class="seq-pop">
        <div class="pop-title">ZOMBIE C â€” AZIONE</div>
        <div class="pop-row"><span class="pop-key">AZIONE</span><span class="pop-val hi-red">TERRORE â€” Urlo</span></div>
        <div class="pop-row"><span class="pop-key">BERSAGLIO</span><span class="pop-val">Giocatore</span></div>
        <div class="pop-row"><span class="pop-key">DANNO</span><span class="pop-val hi-red">4 PT</span></div>
        <div class="pop-row"><span class="pop-key">EFFETTO</span><span class="pop-val hi-viol">VulnerabilitÃ Ã—1</span></div>
        <div class="pop-row"><span class="pop-key">NOTA</span><span class="pop-val">Zombie C ha VULN â€” prende danno doppio</span></div>
      </div>
    </div>
  </div>

  <!-- MESSAGE STRIP -->
  <div id="msg-strip"></div>

  <!-- CARTE -->
  <div id="hud-cards">

    <div class="card vg">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">CD0</div>
        <div class="c-name">Attacco Base</div>
        <div class="c-cost">1âœŠ â†’ 1 DAN</div>
        <div class="c-art">âš”ï¸</div>
        <div class="c-effect">
          Spendi 1 impulso Forza.<br>
          Infliggi 1 danno a un nemico adiacente.<br>
          <span style="color:var(--acid)">+1DAN se Amplificazione Elementale.</span>
        </div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">+1ğŸ›¡ in Futuro</span></div>
    </div>

    <div class="card vg">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">CD0</div>
        <div class="c-name">Scatto</div>
        <div class="c-cost">1âœŠ â†’ +2PM</div>
        <div class="c-art">âš¡</div>
        <div class="c-effect">
          Spendi 1 impulso Forza.<br>
          Guadagni 2 PM questo turno.<br>
          <span style="color:var(--muted)">Movimento: uscire da adiacenza costa 2PM.</span>
        </div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">+1 carta mano</span></div>
    </div>

    <div class="card sp">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">CD2</div>
        <div class="c-name">ProfonditÃ  Mente</div>
        <div class="c-cost">1ğŸ”® + 1PT</div>
        <div class="c-art">ğŸ”®</div>
        <div class="c-effect">
          Spendi 1 Presagio e 1 PT.<br>
          Pesca 2 carte e scartane 1.<br>
          <span style="color:var(--violet)">Effetto: guarda le prossime 3 azioni nemico.</span>
        </div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">dado libero in Futuro</span></div>
    </div>

    <div class="card fu">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">CD1</div>
        <div class="c-name">Attacco Fuoco</div>
        <div class="c-cost">1ğŸ”¥ â†’ 2 DAN</div>
        <div class="c-art">ğŸ”¥</div>
        <div class="c-effect">
          Spendi 1 impulso Fuoco.<br>
          Infliggi 2 danni a un bersaglio a raggio 2.<br>
          <span style="color:var(--red)">Ignora Scudo se bersaglio ha VULN.</span>
        </div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">d6âœŠ in Futuro</span></div>
    </div>

    <div class="card vg">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">CD1</div>
        <div class="c-name">Attacco Poderoso</div>
        <div class="c-cost">1âœŠ â†’ 2 DAN</div>
        <div class="c-art">ğŸ’¥</div>
        <div class="c-effect">
          Spendi 1 impulso Forza.<br>
          Infliggi 2 danni. Spinta 1 se bersaglio colpisce ostacolo.<br>
          <span style="color:var(--acid)">Danno collisione: (X - N) aggiuntivo.</span>
        </div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">d4ğŸ”¥ in Futuro</span></div>
    </div>

    <div class="card fu on-cd">
      <div class="c-stripe"></div>
      <div class="c-body">
        <div class="c-cd">â³ CD1</div>
        <div class="c-name">Cono di Fuoco</div>
        <div class="c-cost">1ğŸ”¥ AOE</div>
        <div class="c-art">ğŸŒ‹</div>
      </div>
      <div class="c-eco"><span class="eco-l">ECO</span><span class="eco-v">d6âœŠ</span></div>
    </div>

  </div>

  <div id="btn-end">FINE TURNO â†’</div>
  <div id="zoom-hint">scroll = zoom Â· drag = sposta</div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CANVAS â€” grid + sprites
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('gc');
const ctx = canvas.getContext('2d');

let cam = { x:0, y:0, zoom:1 };
let drag = { on:false, sx:0, sy:0, cx:0, cy:0 };
let hov = [-1,-1];

// Hex geometry â€” flat-top, very squashed (low-angle isometric)
const HW = 52;   // half-width
const HH = 20;   // half-height (very flat for strong perspective)
const COLS = 10;
const ROWS = 9;

function hexCenter(col, row) {
  const off = row % 2 === 0 ? 0 : HW;
  return [col * HW * 2 + off, row * HH * 1.6];
}

function hexPoints(cx, cy) {
  return [
    [cx + HW, cy],
    [cx + HW*.5, cy - HH],
    [cx - HW*.5, cy - HH],
    [cx - HW, cy],
    [cx - HW*.5, cy + HH],
    [cx + HW*.5, cy + HH],
  ];
}

const PLAYER = [2, 3];
const ENEMIES = [[5,4],[7,4],[6,5]];
const RANGE = [[3,3],[4,3],[5,3],[3,4],[4,4],[6,4],[3,5],[4,5],[5,5]];

function cellType(c, r) {
  if (c===PLAYER[0] && r===PLAYER[1]) return 'player';
  for (const [ec,er] of ENEMIES) if (c===ec && r===er) return 'enemy';
  for (const [rc,rr] of RANGE) if (c===rc && r===rr) return 'range';
  return 'normal';
}

function drawHex(pts, fill, stroke, lw=1, dash=[]) {
  ctx.beginPath();
  ctx.moveTo(pts[0][0], pts[0][1]);
  for (let i=1; i<pts.length; i++) ctx.lineTo(pts[i][0], pts[i][1]);
  ctx.closePath();
  ctx.fillStyle = fill; ctx.fill();
  ctx.setLineDash(dash);
  ctx.strokeStyle = stroke; ctx.lineWidth = lw; ctx.stroke();
  ctx.setLineDash([]);
}

// Draw full-body humanoid silhouette
function drawHumanoid(cx, cy, h, color, glowColor) {
  // All measurements relative to h (total height)
  const headR  = h * 0.10;
  const bodyH  = h * 0.28;
  const bodyW  = h * 0.14;
  const legH   = h * 0.28;
  const legW   = h * 0.065;
  const armH   = h * 0.22;
  const armW   = h * 0.055;
  const headY  = cy - h + headR;
  const shouldY = headY + headR + h * 0.01;
  const hipY   = shouldY + bodyH;
  const feetY  = hipY + legH;

  ctx.save();
  ctx.shadowColor = glowColor;
  ctx.shadowBlur  = 18;
  ctx.fillStyle   = color;
  ctx.strokeStyle = color;
  ctx.lineWidth   = 1;

  // head
  ctx.beginPath();
  ctx.arc(cx, headY, headR, 0, Math.PI * 2);
  ctx.fill();

  // body
  ctx.beginPath();
  ctx.roundRect(cx - bodyW/2, shouldY, bodyW, bodyH, 2);
  ctx.fill();

  // left arm
  ctx.beginPath();
  ctx.roundRect(cx - bodyW/2 - armW, shouldY + h*0.02, armW, armH, 2);
  ctx.fill();
  // right arm
  ctx.beginPath();
  ctx.roundRect(cx + bodyW/2, shouldY + h*0.02, armW, armH, 2);
  ctx.fill();

  // left leg
  ctx.beginPath();
  ctx.roundRect(cx - bodyW/2 + h*0.01, hipY, legW, legH, 2);
  ctx.fill();
  // right leg
  ctx.beginPath();
  ctx.roundRect(cx + bodyW/2 - legW - h*0.01, hipY, legW, legH, 2);
  ctx.fill();

  ctx.restore();
}

function drawHpBar(cx, cy, pct, color, w=44) {
  const bx = cx - w/2, by = cy + 4;
  ctx.fillStyle = 'rgba(0,0,0,0.55)';
  roundRect(bx, by, w, 3, 1.5);
  ctx.fill();
  ctx.fillStyle = color;
  ctx.shadowColor = color; ctx.shadowBlur = 4;
  roundRect(bx, by, w * pct, 3, 1.5);
  ctx.fill();
  ctx.shadowBlur = 0;
}

function roundRect(x,y,w,h,r) {
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.lineTo(x+w-r, y);
  ctx.arcTo(x+w,y, x+w,y+r, r);
  ctx.lineTo(x+w, y+h-r);
  ctx.arcTo(x+w,y+h, x+w-r,y+h, r);
  ctx.lineTo(x+r, y+h);
  ctx.arcTo(x,y+h, x,y+h-r, r);
  ctx.lineTo(x, y+r);
  ctx.arcTo(x,y, x+r,y, r);
  ctx.closePath();
}

function render() {
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(cam.x, cam.y);
  ctx.scale(cam.zoom, cam.zoom);

  // â”€â”€ Grid â”€â”€
  for (let row = 0; row < ROWS; row++) {
    for (let col = 0; col < COLS; col++) {
      const [cx,cy] = hexCenter(col,row);
      const pts = hexPoints(cx,cy);
      const type = cellType(col,row);
      const isHov = hov[0]===col && hov[1]===row;
      let fill, stroke, lw=1, dash=[];
      if (isHov) { fill='rgba(0,229,255,0.07)'; stroke='rgba(0,229,255,0.35)'; lw=1.5; }
      else if (type==='player') { fill='rgba(180,79,255,0.12)'; stroke='rgba(180,79,255,0.55)'; lw=1.5; }
      else if (type==='enemy')  { fill='rgba(255,45,45,0.09)'; stroke='rgba(255,45,45,0.45)'; lw=1.5; }
      else if (type==='range')  { fill='rgba(0,229,255,0.035)'; stroke='rgba(0,229,255,0.15)'; dash=[5,3]; }
      else { fill='rgba(8,8,28,0.5)'; stroke='rgba(22,27,60,0.75)'; }
      drawHex(pts, fill, stroke, lw, dash);
    }
  }

  // Range ring
  const [pcx,pcy] = hexCenter(PLAYER[0], PLAYER[1]);
  ctx.beginPath();
  ctx.arc(pcx, pcy, HW*2.9, 0, Math.PI*2);
  ctx.strokeStyle = 'rgba(0,229,255,0.05)';
  ctx.lineWidth = 1;
  ctx.setLineDash([6,5]);
  ctx.stroke();
  ctx.setLineDash([]);

  // â”€â”€ GIOCATORE â”€â”€
  const [px,py] = hexCenter(PLAYER[0], PLAYER[1]);
  // shadow on hex
  ctx.save();
  ctx.beginPath();
  ctx.ellipse(px, py+HH*.2, HW*.45, HH*.4, 0, 0, Math.PI*2);
  ctx.fillStyle = 'rgba(180,79,255,0.3)';
  ctx.fill();
  ctx.restore();
  // figure â€” tall, elegant
  drawHumanoid(px, py - HH*.1, HH*3.8, 'rgba(195,130,255,0.92)', 'rgba(180,79,255,0.6)');
  drawHpBar(px, py + HH*.3, 0.8, '#39ff14');

  // â”€â”€ ZOMBIE sprites â”€â”€
  const zombies = [
    { cell: ENEMIES[0], hp:1.0 },
    { cell: ENEMIES[1], hp:0.5 },
    { cell: ENEMIES[2], hp:1.0 },
  ];
  for (const { cell, hp } of zombies) {
    const [ex,ey] = hexCenter(cell[0], cell[1]);
    ctx.save();
    ctx.beginPath();
    ctx.ellipse(ex, ey+HH*.2, HW*.4, HH*.35, 0, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,45,45,0.22)';
    ctx.fill();
    ctx.restore();
    // zombie â€” hunched, shorter
    drawHumanoid(ex, ey, HH*3.0, 'rgba(255,100,100,0.82)', 'rgba(255,45,45,0.5)');
    drawHpBar(ex, ey + HH*.25, hp, '#ff2d2d', 36);
  }

  ctx.restore();
}

// â”€â”€ Controls â”€â”€
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const gW = COLS * HW * 2;
  const gH = ROWS * HH * 1.6;
  cam.x = (canvas.width - gW) / 2 + HW;
  cam.y = (canvas.height - gH) / 2 + HH * 2 - 40;
  render();
}

canvas.addEventListener('mousedown', e => {
  drag.on=true; drag.sx=e.clientX; drag.sy=e.clientY; drag.cx=cam.x; drag.cy=cam.y;
});
window.addEventListener('mousemove', e => {
  if (drag.on) { cam.x=drag.cx+(e.clientX-drag.sx); cam.y=drag.cy+(e.clientY-drag.sy); render(); }
  updateHover(e.clientX, e.clientY);
});
window.addEventListener('mouseup', () => drag.on=false);

canvas.addEventListener('wheel', e => {
  e.preventDefault();
  const f = e.deltaY < 0 ? 1.1 : 0.91;
  const mx = e.clientX, my = e.clientY;
  cam.x = mx - (mx - cam.x) * f;
  cam.y = my - (my - cam.y) * f;
  cam.zoom = Math.min(Math.max(cam.zoom * f, 0.3), 2.8);
  render();
}, { passive:false });

function updateHover(sx, sy) {
  const wx = (sx - cam.x) / cam.zoom;
  const wy = (sy - cam.y) / cam.zoom;
  let found = [-1,-1];
  outer: for (let row=0; row<ROWS; row++) {
    for (let col=0; col<COLS; col++) {
      const [cx,cy] = hexCenter(col,row);
      const dx = (wx-cx)/HW, dy = (wy-cy)/HH;
      if (dx*dx + dy*dy < 1) { found=[col,row]; break outer; }
    }
  }
  if (found[0]!==hov[0] || found[1]!==hov[1]) { hov=found; render(); }
}

// touch
let lastT = null;
canvas.addEventListener('touchstart', e => { lastT=e.touches[0]; }, {passive:true});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  const t=e.touches[0];
  cam.x+=t.clientX-lastT.clientX; cam.y+=t.clientY-lastT.clientY;
  lastT=t; render();
}, {passive:false});

// â”€â”€ Message strip demo â”€â”€
function showMsg(txt, duration=3000) {
  const el = document.getElementById('msg-strip');
  el.textContent = txt;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), duration);
}

// Demo messages on interaction
document.getElementById('btn-end').addEventListener('click', () => {
  showMsg('â–¸ TURNO TERMINATO â€” Rotazione Cooldown completata');
});
document.querySelectorAll('.card:not(.on-cd)').forEach(c => {
  c.addEventListener('click', () => showMsg('â–¸ Seleziona un bersaglio sulla griglia'));
});

window.addEventListener('resize', resize);
resize();
</script>
</body>
</html>
